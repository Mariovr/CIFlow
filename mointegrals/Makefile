#
# Plugin Makefile generated by Psi4.
#
# You shouldn't need to modify anything in this file.
#

# Rudimentary platform support. Linux for Mario, Darwin for Guillaume.

# Location of your PSI4 source and PSI4 install
UNAME_S := $(shell uname -s)
ifeq ($(UNAME_S), Linux)
	top_srcdir = /home/mario/Downloads/psi4.0b5
	top_objdir = /home/mario/Downloads/psi4.0b5/obj
endif
ifeq ($(UNAME_S), Darwin)
	top_srcdir = /Users/mariovr/Downloads/psi4.0b5
	top_objdir = /Users/mariovr/Downloads/psi4.0b5/obj
endif

# Start by figuring out whether we're on Linux or Mac (sorry, Mr. Gates)
UNAME := $(shell uname)

include $(top_objdir)/src/bin/MakeVars

# Reset these values, MakeVars changes them to valud only valid in Psi4's objdir
# Location of your PSI4 source and PSI4 install
UNAME_S := $(shell uname -s)
ifeq ($(UNAME_S), Linux)
	top_srcdir = /home/mario/Downloads/psi4.0b5
	top_objdir = /home/mario/Downloads/psi4.0b5/obj
endif
ifeq ($(UNAME_S), Darwin)
	top_srcdir = /Users/mariovr/Downloads/psi4.0b5
	top_objdir = /Users/mariovr/Downloads/psi4.0b5/obj
endif

PSITARGET = $(shell basename `pwd`).so
PSILIBS = -L$(top_objdir)/lib -lPSI_plugin -lm -L/usr/lib -lhdf5 -lmpi -lmpi_cxx

CXXSRC = $(notdir $(wildcard *.cc))
DEPENDINCLUDE = $(notdir $(wildcard *.h))

BINOBJ = $(CXXSRC:%.cc=%.o)

default:: $(PSITARGET)

# Add the flags needed for shared library creation
ifeq ($(UNAME), Linux)
    LDFLAGS = -shared
endif
ifeq ($(UNAME), Darwin)
    LDFLAGS = -shared -undefined dynamic_lookup
    CXXOTH += -fno-common
endif

CXXFLAGS += -std=c++11

all : so $(PSITARGET)

# The object files
%.o: %.cc
	$(CXX) $(CXXFLAGS) $(CXXINCLUDE) -c $< $(OUTPUT_OPTION)

$(PSITARGET): $(BINOBJ)
	$(CXX) $(LDFLAGS) -o $@ mointegrals.o $(CXXDBG) $(PSILIBS)

so: $(BINOBJ)
	$(CXX) $(LDFLAGS) -o sointegrals.so sointegrals.o $(CXXDBG) $(PSILIBS)

# Erase all compiled intermediate files
clean:
	rm -f $(BINOBJ) $(PSITARGET) *.d *.so *.pyc *.test output.dat psi.timer.dat

# Dependency handling
%.d: %.cc
	$(CXXDEPEND) $(CXXDEPENDFLAGS) $(CXXFLAGS) $(CXXINCLUDE) $< | sed 's/^$*.o/$*.o $*.d/g' > $(@F)

ifneq ($(DODEPEND),no)
$(BINOBJ:%.o=%.d): $(DEPENDINCLUDE)
include $(BINOBJ:%.o=%.d)
endif

.PHONY: cleanall
cleanall:
	rm -rf mointegrals.o mointegrals.so
	rm -rf sointegrals.o sointegrals.so

